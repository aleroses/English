<link rel="preconnect" href="https://fonts.googleapis.com" />
<link
  rel="preconnect"
  href="https://fonts.gstatic.com"
  crossorigin
/>
<link
  href="https://fonts.googleapis.com/css2?family=Inter+Tight:ital,wght@0,100..900;1,100..900&display=swap"
  rel="stylesheet"
/>

<header id="rubric">{{Rubric}}</header>

{{#Image}}
<main class="main main__one">
  <div id="image" class="image-box">{{Image}}</div>
  <section class="question-box">
    <p class="question">{{cloze:Question}}</p>
  </section>
</main>
{{/Image}} {{^Image}}
<main class="main main__two">
  <p class="question">{{cloze:Question}}</p>
</main>
{{/Image}}

<section id="audio">{{Audio}}</section>
<section class="match">{{type:cloze:Question}}</section>

<div id="footer">
  <div id="category">{{Category}}</div>
  <div id="unit">{{Unit}}</div>
</div>

<script>
  (function () {
    /* var question =
      document.getElementById("question").innerHTML;
    document.getElementById("question").innerHTML =
      question.replace(/\(<i>[^\)]*<\/i>\)/g, "");

    var question =
      document.getElementById("question").innerHTML;
    question = question.replace(
      /<span class="cloze">-<\/span>/,
      ""
    );
    question = question.replace(
      /<span class="cloze">–<\/span>/,
      ""
    );
    question = question.replace(
      / <span class="cloze">,/,
      '<span class="cloze">,'
    );
    question = question.replace(
      / <span class="cloze">'/,
      '<span class="cloze">\''
    );
    question = question.replace(/<\/span> +,/, "</span>,");
    question = question.replace(/ +\./, ".");
    document.getElementById("question").innerHTML = question; */

    var isDialog = false;
    var count = 0;
    // var lines = `{{cloze::Question}}`.split("<br />");

    for (var i = 0; i < lines.length; i++) {
      if (lines[i].indexOf(":") != -1) {
        count = count + 1;
      }
    }
    if (count >= 2) {
      isDialog = true;
    }
    if (isDialog) {
      // var element = document.getElementById("question");
      var parent = element.parentNode;
      var wrapper = document.createElement("div");
      parent.replaceChild(wrapper, element);
      wrapper.appendChild(element);
      element.className = "l";
    }

    /* if (
      document.getElementById("question").innerHTML.length >
        400 &&
      document.getElementById("container") != null &&
      !isDialog
    ) {
      document.getElementById("container").className = "";
      document.getElementById("image").className = "p-image";
      document.getElementById("question").className = "";
      document.querySelector(".t-question").className =
        "p-question";
    } */

    /* if (
      /<span class="cloze">[^<]*<\/span> ?<u>[^<]*<\/u>/.test(
        question
      )
    ) {
      document.getElementById("question").innerHTML = question.replace(/ ?<u>[^<]*<\/u>/g, "");
      var question =
        document.getElementById("question").innerHTML;
      var regex =
        /<span class="cloze">[^<]*<\/span>( ?<u>[^<]*<\/u>)/g;
      var m;

      while (
        (m = regex.exec(
          document.getElementById("question").innerHTML
        )) !== null
      ) {
        var underline_text = m[1];
        question = question.replace(underline_text, "");
      }
      document.getElementById("question").innerHTML =
        question;
    }

    var question =
      document.getElementById("question").innerHTML;
    if (
      /<span class="cloze">[^<]*-[^<]*<\/span>/.test(question)
    ) {
      var cloze_text =
        /<span class="cloze">([^<]*)<\/span>/.exec(
          question
        )[1];
      document.getElementById("question").innerHTML =
        question.replace(
          cloze_text,
          cloze_text.replace("-", "–")
        );
    } */
  })();
</script>
